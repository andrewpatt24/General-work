{
    "contents" : "detach()\nlibrary(XML)\nlibrary(caret)\nlibrary(lpSolve)\n\n###############\n####Webscrape##\n###############\n# URL of interest: \nmps <- \"http://fantasy.premierleague.com/player-list/\" \n# parse the document for R representation: \nmps.doc <- htmlParse(mps)\n# get all the tables in mps.doc as data frames\nmps.tabs <- readHTMLTable(mps.doc) \nsummary(mps.tabs)\nmps.tabs[[2]]\n\n\n##################\n####Manipulation##\n##################\n##Manipulate into table\nmps.GK<-rbind(mps.tabs[[1]],mps.tabs[[2]])\nmps.GK$Position<-as.factor(\"GK\")\nmps.DF<-rbind(mps.tabs[[3]],mps.tabs[[4]])\nmps.DF$Position<-as.factor(\"DF\")\nmps.MD<-rbind(mps.tabs[[5]],mps.tabs[[6]])\nmps.MD$Position<-as.factor(\"MD\")\nmps.FD<-rbind(mps.tabs[[7]],mps.tabs[[8]])\nmps.FD$Position<-as.factor(\"FD\")\n##Bind for full data\nfooty.data<-rbind(mps.GK,mps.DF,mps.MD,mps.FD)\n##Change storage of each variable\nfooty.data$Cost<-as.numeric(as.character(substring(footy.data$Cost,2)))\nfooty.data$Points<-as.numeric(as.character(footy.data$Points))\nfooty.data$Player<-as.character(footy.data$Player)\nlevels(footy.data$Team)<-cbind(\"\",levels(footy.data$Team))\nlevels(footy.data$Position)<-cbind(\"\",levels(footy.data$Position))\nstr(footy.data)\n\n#ok\ndim(footy.data) ##[1] 583   5\n\n##Create dummy variables\nfact.only<-footy.data[, which(sapply(footy.data, class)==\"factor\")]\nnon.fact<-footy.data[, which(sapply(footy.data, class)!=\"factor\")]\nfooty.data.dummy<-model.matrix(~ Position + Team, data=fact.only, \n             contrasts.arg=list(Position=contrasts(fact.only$Position, contrasts=F), \n                                Team=contrasts(fact.only$Team, contrasts=F)))\n\nfooty.data.dummy2<-footy.data.dummy[,-1]\ncolnames(footy.data.dummy2)<-gsub(\"[^#A-Za-z0-9_]\",\"\",colnames(footy.data.dummy2))\n######################\n##Produce Final Data##\n######################\nfooty.final<-cbind(non.fact,footy.data.dummy2)\ncolnames(footy.final)\n\n##SAVE FILE\nfooty.final.20131209<-footy.final\nsave(footy.final.20131209,file=\"foot_data_20131209.R\")\n\n\n# URL of interest: \nmps <- \"http://www.footballdatabase.com/leagues.php?liga=200&season=201314\" \n# parse the document for R representation: \nmps.doc <- htmlParse(mps)\n# get all the tables in mps.doc as data frames\nmps.tabs <- readHTMLTable(mps.doc) \nsummary(mps.tabs)\nmps.tabs[[2]]\n\n#########################\n##Optimum squad selector#\n#########################\n\nOpt.squad<-function(dat,cst,n.gk=2,n.df=5,n.md=5,n.fd=3) {\n  #dat<-footy.final\n  #nplay<-13\n  #cst<-91.7\n  #ngk<-2\n  \n    ##Attach play\n  attach(dat)\n  #length(Cost)\n  \n  ##Pick optimum team\n  f.obj <- Points\n  nn<-length(f.obj)\n  play  <- rep(1,nn)\n  n.choose<-n.gk+n.df+n.md+n.fd\n  f.con <- cbind(Cost,PositionGK,PositionDF,PositionMD,PositionFD,TeamArsenal,TeamAstonVilla,TeamCardiffCity,TeamChelsea,TeamCrystalPalace,TeamEverton,TeamFulham\n                ,TeamHullCity,TeamLiverpool,TeamManCity,TeamManUtd,TeamNewcastle,TeamNorwich,TeamSouthampton\n                ,TeamStokeCity,TeamSunderland,TeamSwansea,TeamTottenham,TeamWestBrom,TeamWestHam ,play)\n  f.con <- t(f.con)\n  f.dir <- c(\"<=\",\"=\",\"=\",\"=\",\"=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\",\"=\")\n  f.rhs <- c(cst,n.gk,n.df,n.md,n.fd,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,n.choose)\n  out1  <- lp(\"max\", f.obj, f.con, f.dir, f.rhs,all.bin=TRUE)\n  sol1  <- out1$solution\n  total1 <- out1$objval \n  ###Take numbers and take out \n  pick1a <- rep(0,15)\n  k     <- 0\n  f.obj2<-f.obj\n  for (j in 1:nn) {\n    if (sol1[j]==1) {\n      k        <- k+1\n      pick1a[k] <- j\n    }\n  }\n  detach(dat)\nfinal.pick<-dat[pick1a,1:3]\nfinal.pick\n}\n\n\n#################################\n##Pick best squad################\n#################################\n\nw4.pick<-Opt.squad(footy.final,n.gk=1,n.df=4,n.md=5,n.fd=2,90) \nw4.pick\n\n\n\n\n\n\n\n###WIP##########\n\nopt.change<-function(dat,change,team.val,init.pick) {\n  #dat<-dat.w1\n  #change<-1\n  #pick<-init.pick\n  #team.val<-100\n  \n  \n  \n  attach(dat)\n  \n  f.obj <- Points\n  nn<-length(f.obj)\n  play  <- rep(1,nn)\n  f.con <- cbind(Cost,GK,Defence,Midfield,Attack,Aston.Villa,Chelsea,Everton,Fulham,\n                 Liverpool,Man.City,Man.Utd,Newcastle,Norwich,QPR,Reading,Southampton,\n                 Stoke.City,Sunderland,Swansea,Tottenham,West.Brom,West.Ham,Wigan,play,pick)\n  f.con <- t(f.con)\n  f.dir <- c(\"<=\",\"=\", \"=\",\">=\",\">=\",\">=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"<=\", \"<=\",\"<=\",\"<=\",\"=\",\">=\")\n  f.rhs <- c(team.val,0,2,4,4,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,15,15-change)\n  out1  <- lp (\"max\", f.obj, f.con, f.dir, f.rhs,all.bin=TRUE)\n  sol1  <- out1$solution\n  total1 <- out1$objval\n  \n  squad <- rep(0,15)\n  k     <- 0\n  for (j in 1:nn) {\n    if (sol1[j]==1) {\n      k        <- k+1\n      squad[k] <- j\n    }\n  }\n  squad.dat <- dat[squad,]\n  \n  detach(dat)\n  attach(squad.dat)\n  \n  play      <- rep(1,15)\n  f.obj     <- Points\n  f.con     <- cbind(GK,Defence,Attack,play)\n  f.con     <- t(f.con)\n  f.dir     <- c(\"=\",\">=\",\">=\",\"=\")\n  f.rhs     <- c(1,3,1,11)\n  sol1      <- lp (\"max\", f.obj, f.con, f.dir, f.rhs,all.bin=TRUE)\n  sol2      <- sol1$solution\n  \n  team     <- rep(0,11)\n  k         <- 0\n  for (j in 1:15) {\n    if (sol2[j]==1) {\n      k<-k+1\n      team[k]<-j}\n  }\n  detach(dat)\n  list(squad=squad,team=team)\n}\n",
    "created" : 1386608718360.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "112470656",
    "id" : "8542DB6",
    "lastKnownWriteTime" : 1387554760,
    "path" : "P:/R repositories/Fantasyfootball/Get_footy_data.R",
    "project_path" : "Get_footy_data.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}